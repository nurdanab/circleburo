import{r as e,j as t}from"./vendor-react-DGsprnG_.js";import{s as a}from"./supabaseClient-CtA22CKB.js";import{u as s}from"./i18n-CcrSPu84.js";import{m as r}from"./framer-motion-CNyOhlkC.js";import{g as n,c as i,d as o,e as l,L as c,U as d,b as m,n as h}from"./lucide-icons-BzS6JU5C.js";import"./analytics-jR0q-LqR.js";import"./supabase-D6DFX1W9.js";import"./vendor-CCnSY37f.js";const x={PENDING:"pending",CONFIRMED:"confirmed",CANCELLED:"cancelled"};const u=()=>{const{t:u}=s();const[g,b]=e.useState(1);const[p,w]=e.useState({name:"",phone:"+7 "});const[y,f]=e.useState(null);const[N,j]=e.useState(null);const[v,D]=e.useState([]);const[F,k]=e.useState(!1);const[C,S]=e.useState(!1);const[I,M]=e.useState("");const[E,T]=e.useState(null);const[$,_]=e.useState(x.PENDING);const O=["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00"];const L=Array.from({length:50},(e,t)=>({id:t,size:2*Math.random()+1,x:100*Math.random(),y:100*Math.random(),delay:3*Math.random(),duration:3*Math.random()+2,opacity:.6*Math.random()+.2,twinkleDelay:4*Math.random()}));const A=Array.from({length:8},(e,t)=>({id:t,size:80*Math.random()+30,x:100*Math.random(),y:100*Math.random(),delay:3*Math.random(),duration:8*Math.random()+10,opacity:.08*Math.random()+.03}));const[P,H]=e.useState(new Date);const R=(()=>{const e=[];const t=new Date;let a=new Date(t);let s=0;for(;s<30;){const t=a.getDay();if(t>=1&&t<=5){e.push(new Date(a));s++}a.setDate(a.getDate()+1)}return e})();const X=()=>{const e=P.getFullYear();const t=P.getMonth();const a=new Date(e,t,1);const s=new Date(e,t+1,0);const r=a.getDay();const n=[];for(let i=0;i<r;i++)n.push(null);for(let i=1;i<=s.getDate();i++){const a=new Date(e,t,i);n.push(a)}return n};const z=e=>{if(!e)return!1;const t=new Date;t.setHours(0,0,0,0);e.setHours(0,0,0,0);if(e<t)return!1;const a=e.getDay();return 0!==a&&6!==a&&R.some(t=>t.toDateString()===e.toDateString())};const G=e=>{H(t=>{const a=new Date(t);a.setMonth(t.getMonth()+e);return a})};const q=[u("calendar.january"),u("calendar.february"),u("calendar.march"),u("calendar.april"),u("calendar.may"),u("calendar.june"),u("calendar.july"),u("calendar.august"),u("calendar.september"),u("calendar.october"),u("calendar.november"),u("calendar.december")];const U=[u("calendar.sun"),u("calendar.mon"),u("calendar.tue"),u("calendar.wed"),u("calendar.thu"),u("calendar.fri"),u("calendar.sat")];const Y=e.useCallback(async e=>{if(!e){D([]);return}S(!0);const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())).toISOString().split("T")[0];try{const{data:e,error:s}=await a.from("leads").select("meeting_time, status, id, name").eq("meeting_date",t).in("status",[x.PENDING,x.CONFIRMED]).order("meeting_time",{ascending:!0});if(s)throw s;const r=(e||[]).map(e=>({...e,meeting_time:e.meeting_time.slice(0,5)}));D(r)}catch(s){void 0;M(u("contactForm.loadingSlots"));D([])}finally{S(!1)}},[u]);const V=e=>{const[t,a]=e.split(":").map(Number);return 60*t+a};const B=e.useCallback((e,t)=>{if(!Array.isArray(t)){void 0;return!0}const a=new Date;const s=new Date(a.getFullYear(),a.getMonth(),a.getDate());if(y&&y.toDateString()===s.toDateString()){const[t,s]=e.split(":").map(Number);if(a.getHours()>t||a.getHours()===t&&a.getMinutes()>=s)return!1}const r=V(e);for(const n of t)if([x.PENDING,x.CONFIRMED].includes(n.status)&&r===V(n.meeting_time))return!1;return!0},[y]);const J=e.useCallback(async(e,t)=>{if(!t)return!0;const s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())).toISOString().split("T")[0];try{const{data:t,error:r}=await a.from("leads").select("meeting_time, status, id, name").eq("meeting_date",s).eq("meeting_time",e).in("status",[x.PENDING,x.CONFIRMED]);if(r){void 0;return!1}return!(t&&t.length>0)}catch(r){void 0;return!1}},[]);const W=e=>{const t=e.replace(/\D/g,"");return/^7\d{10}$/.test(t)};const Q=async()=>{if(p.name.trim())if(W(p.phone))if(y&&N){k(!0);M("");try{const e=new Date(Date.UTC(y.getFullYear(),y.getMonth(),y.getDate())).toISOString().split("T")[0];const{data:t,error:s}=await a.from("leads").select("meeting_time, status, id, name").eq("meeting_date",e).in("status",[x.PENDING,x.CONFIRMED]).order("meeting_time",{ascending:!0});if(s)throw s;const r=(t||[]).map(e=>({...e,meeting_time:e.meeting_time.slice(0,5)}));const n=B(N,r);const i=await J(N,y);if(!n||!i){M(u("contactForm.errors.slotUnavailable"));k(!1);return}const o=p.phone.replace(/\D/g,"");const l={name:p.name.trim(),phone:o,meeting_date:e,meeting_time:N,status:x.PENDING};const{data:c,error:d}=await a.from("leads").insert([l]).select();if(d)throw d;if(c&&c[0]){T(c[0].id);_(c[0].status)}await K(l,c[0]?.id);const m={meeting_time:N,status:x.PENDING,id:c[0]?.id,name:p.name.trim()};D(e=>{0;return[...e,m]});y&&await Y(y);b(3)}catch(e){void 0;M(u("contactForm.errors.submissionError"))}finally{k(!1)}}else M(u("contactForm.errors.noDateOrTime"));else M(u("contactForm.errors.invalidPhone"));else M(u("contactForm.errors.invalidName"))};const K=async(e,t)=>{const a="8193267768:AAFgL65AXJAwjv5iHCNncDV-QNt6mjReqYo";const s="-4968632931";try{const r=y.toLocaleDateString("ru-RU",{weekday:"long",year:"numeric",month:"long",day:"numeric"});const n=`\nNew consultation request:\n\nName: ${e.name}\nPhone: +${e.phone}\nDate: ${r}\nTime: ${e.meeting_time}\nStatus: Pending approval\n\nID: ${t}\n      `.trim();await fetch(`https://api.telegram.org/bot${a}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:s,text:n,parse_mode:"HTML"})})}catch(r){void 0}};const Z=e=>{const t=e.replace(/\D/g,"");let a="+7";t.length>1&&(a+=" "+t.substring(1,4));t.length>4&&(a+=" "+t.substring(4,7));t.length>7&&(a+=" "+t.substring(7,9));t.length>9&&(a+=" "+t.substring(9,11));return a.trim()};const ee=e=>{const t=Z(e.target.value);w({...p,phone:t})};const te=()=>{b(1);w({name:"",phone:"+7 "});f(null);j(null);M("");T(null);_(x.PENDING)};const ae=e.useCallback(async()=>{if(E)try{const{data:e,error:t}=await a.from("leads").select("status").eq("id",E).single();if(t)throw t;e&&e.status!==$&&_(e.status)}catch(e){void 0}},[E,$]);e.useEffect(()=>{y?Y(y):D([])},[y,Y]);e.useEffect(()=>{if(!y)return;const e=setInterval(()=>{Y(y)},3e4);return()=>clearInterval(e)},[y,Y]);e.useEffect(()=>{if(E&&3===g){const e=setInterval(ae,3e4);return()=>clearInterval(e)}},[E,g,ae]);e.useEffect(()=>{$===x.CONFIRMED&&void 0;$===x.CANCELLED&&void 0},[$]);return t.jsxs("section",{id:"contact",className:"bg-black text-white py-20 px-6 md:px-20 relative overflow-hidden min-h-screen flex items-center",children:[t.jsxs(r.div,{className:"absolute inset-0 z-0",children:[L.map(e=>t.jsx(r.div,{className:"absolute",style:{left:`${e.x}%`,top:`${e.y}%`,transform:"translate(-50%, -50%)"},initial:{scale:0,opacity:0},animate:{scale:1,opacity:e.opacity},transition:{duration:.6,delay:e.delay},children:t.jsx(r.div,{className:"bg-white rounded-full",style:{width:`${e.size}px`,height:`${e.size}px`,boxShadow:`0 0 ${2*e.size}px rgba(255, 255, 255, 0.5)`},animate:{opacity:[.3*e.opacity,e.opacity,.3*e.opacity],scale:[.8,1.2,.8]},transition:{duration:e.duration,repeat:1/0,repeatType:"reverse",ease:"easeInOut",delay:e.twinkleDelay}})},`star-${e.id}`)),A.map(e=>t.jsx(r.div,{className:"absolute rounded-full",style:{width:`${e.size}px`,height:`${e.size}px`,left:`${e.x}%`,top:`${e.y}%`,transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 30%, transparent 70%)",border:"1px solid rgba(255, 255, 255, 0.06)"},initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{duration:1.2,delay:e.delay},children:t.jsx(r.div,{className:"absolute inset-2 rounded-full",style:{background:"radial-gradient(circle, rgba(255, 255, 255, 0.04) 0%, transparent 60%)"},animate:{scale:[1,1.1,1],opacity:[e.opacity,1.5*e.opacity,e.opacity]},transition:{duration:e.duration,repeat:1/0,repeatType:"reverse",ease:"easeInOut"}})},`glow-${e.id}`))]}),t.jsxs("div",{className:"absolute inset-0 z-0",children:[t.jsx("div",{className:"absolute top-1/4 right-1/4 w-64 h-64 bg-gradient-radial from-white/8 via-white/4 to-transparent rounded-full blur-3xl animate-pulse"}),t.jsx("div",{className:"absolute bottom-1/3 left-1/6 w-80 h-80 bg-gradient-radial from-white/6 via-white/3 to-transparent rounded-full blur-3xl animate-pulse",style:{animationDelay:"2s"}}),t.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-gradient-radial from-white/3 via-transparent to-transparent rounded-full blur-3xl"})]}),t.jsxs("div",{className:" relative z-10 mb-12",children:[t.jsx(r.h1,{className:"text-4xl md:text-5xl lg:text-6xl font-bold mb-12 text-center",initial:{opacity:0,y:-50},whileInView:{opacity:1,y:0},transition:{duration:.8},viewport:{once:!0},children:u("contactForm.title")}),t.jsx(r.p,{className:"text-lg md:text-xl text-gray-400 mt-20 text-center",style:{textAlign:"center"},initial:{opacity:0,y:-50},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.2},viewport:{once:!0},children:u("contactForm.subtitle")}),3===g?t.jsx(r.div,{initial:{opacity:0,scale:.95,y:30},animate:{opacity:1,scale:1,y:0},transition:{duration:.8,ease:"backOut"},className:"max-w-2xl mx-auto text-center",children:t.jsxs("div",{className:"bg-gradient-to-br from-[#2a2a2a] to-[#1a1a1a] p-12 rounded-3xl border border-white/20 shadow-2xl backdrop-blur-sm",children:[t.jsxs(r.div,{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-gray flex items-center justify-center",initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{duration:.8,delay:.3},children:[$===x.CONFIRMED&&t.jsx(n,{className:"w-10 h-10 text-white"}),$===x.PENDING&&t.jsx(n,{className:"w-10 h-10 text-white"}),$===x.CANCELLED&&t.jsx(i,{className:"w-10 h-10 text-white"})]}),t.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6 text-white mb-10",children:$===x.CONFIRMED?u("contactForm.bookingConfirmed"):u("contactForm.requestSent")}),t.jsxs("div",{className:"space-y-4 mb-8 text-gray-300",children:[t.jsx("p",{className:"text-lg",children:u("contactForm.receivedBooking")}),t.jsx("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(o,{className:"w-5 h-5 text-white"}),t.jsx("span",{className:"font-semibold",children:y?.toLocaleDateString("ru-RU",{weekday:"long",day:"numeric",month:"long"})})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(l,{className:"w-5 h-5 text-white"}),t.jsx("span",{className:"font-semibold",children:N})]})]})})]}),t.jsx("p",{className:"text-gray-400 mb-8",children:$===x.CONFIRMED?u("contactForm.meetingConfirmed"):u("contactForm.managerContact")}),t.jsx(r.button,{onClick:te,className:"px-8 py-4 bg-white border border-white/15 hover:border-white/30 rounded-2xl text-white font-semibold text-lg transition-all duration-300 shadow-lg hover:shadow-xl",whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},children:u("contactForm.bookAnotherSlot")})]})}):t.jsxs(r.div,{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 max-w-6xl mx-auto mt-10",initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.2},viewport:{once:!0},children:[t.jsxs(r.div,{className:"bg-gradient-to-br from-[#2a2a2a] to-[#1a1a1a] p-8 rounded-3xl border border-white/10 shadow-2xl backdrop-blur-sm h-fit",initial:{opacity:0,x:-50},whileInView:{opacity:1,x:0},transition:{duration:.8,delay:.4},viewport:{once:!0},children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx(o,{className:"w-6 h-6 text-white"}),t.jsx("h3",{className:"text-2xl font-bold text-white",children:u("contactForm.selectDateTime")})]}),t.jsxs("div",{className:"mb-8",children:[t.jsx("h4",{className:"text-lg font-semibold text-gray-300 mb-4",children:u("contactForm.availableDates")}),t.jsxs("div",{className:"flex items-center justify-between mb-4 ",children:[t.jsx(r.button,{onClick:()=>G(-1),className:"p-2 rounded-lg bg-white/5 border border-white/20 hover:bg-white/10 hover:border-white/40 transition-all duration-300",whileHover:{scale:1.05},whileTap:{scale:.95},children:t.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),t.jsxs("h3",{className:"text-xl font-bold text-white",children:[q[P.getMonth()]," ",P.getFullYear()]}),t.jsx(r.button,{onClick:()=>G(1),className:"p-2 rounded-lg bg-white/5 border border-white/20 hover:bg-white/10 hover:border-white/40 transition-all duration-300",whileHover:{scale:1.05},whileTap:{scale:.95},children:t.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:U.map(e=>t.jsx("div",{className:"text-center text-xs font-semibold text-gray-500 py-2 uppercase tracking-wide",children:e},e))}),t.jsx("div",{className:"grid grid-cols-7 gap-1",children:X().map((e,a)=>{const s=e&&z(e);const n=e&&y&&e.toDateString()===y.toDateString();const i=e&&e.toDateString()===(new Date).toDateString();return t.jsx(r.div,{className:"aspect-square flex items-center justify-center",children:e?t.jsxs(r.button,{onClick:async()=>{if(s){f(e);j(null);M("");await Y(e)}},disabled:!s,className:`w-full h-full rounded-lg text-sm font-medium transition-all duration-300 flex items-center justify-center relative ${n?"bg-gradient-to-r from-white to-gray-100 text-black shadow-lg shadow-white/20 btn-dark-theme":s?"bg-white/5 text-white border border-white/20 hover:bg-white/10 hover:border-white/40 hover:shadow-md":"bg-white/5 text-gray-600 cursor-not-allowed border border-white/10"}`,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.2,delay:.01*a},whileHover:s?{scale:1.05,y:-1}:{},whileTap:s?{scale:.95}:{},children:[e.getDate(),i&&t.jsx("div",{className:"absolute bottom-1 left-1/2 transform -translate-x-1/2 w-1 h-1 bg-blue-400 rounded-full"})]}):t.jsx("div",{className:"w-full h-full"})},a)})}),t.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-gradient-to-r from-white to-gray-100 rounded-full"}),t.jsx("span",{className:"text-gray-400",children:u("contactForm.legend.selected")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-white/5 border border-white/20 rounded-full"}),t.jsx("span",{className:"text-gray-400",children:u("contactForm.legend.available")})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-white/5 border border-white/10 rounded-full opacity-50"}),t.jsx("span",{className:"text-gray-400",children:u("contactForm.legend.unavailable")})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold text-gray-300 mb-4",children:u("contactForm.availableTimes")}),C?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx(c,{className:"w-8 h-8 animate-spin text-white"})}):t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[O.filter(e=>B(e,v)).map((e,a)=>t.jsx(r.button,{onClick:()=>j(e),className:`px-4 py-3 rounded-xl border font-semibold transition-all duration-300 ${N===e?"bg-gradient-to-r from-white to-gray-100 text-black border-white shadow-lg shadow-white/20 btn-dark-theme":"bg-white/5 text-white border-white/20 hover:bg-white/10 hover:border-white/40 hover:shadow-md"}`,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.05*a},whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},children:e},e)),0===O.filter(e=>B(e,v)).length&&t.jsxs("div",{className:"col-span-3 text-center py-6",children:[t.jsx(l,{className:"w-8 h-8 text-gray-600 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-400",children:u("contactForm.noAvailableSlots")}),y&&t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:u("contactForm.chooseAnotherDate")})]})]})]})]}),t.jsxs(r.div,{className:"bg-gradient-to-br from-[#2a2a2a] to-[#1a1a1a] p-8 rounded-3xl border border-white/10 shadow-2xl backdrop-blur-sm h-fit",initial:{opacity:0,x:50},whileInView:{opacity:1,x:0},transition:{duration:.8,delay:.6},viewport:{once:!0},children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx(d,{className:"w-6 h-6 text-white"}),t.jsx("h3",{className:"text-2xl font-bold text-white",children:u("contactForm.yourInformation")})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:[u("contactForm.fullName")," *"]}),t.jsx(r.input,{type:"text",placeholder:u("contactForm.fullNamePlaceholder"),value:p.name,onChange:e=>w({...p,name:e.target.value}),className:"w-full px-4 py-4 rounded-xl border border-white/20 bg-white/5 text-white placeholder-gray-500 focus:border-white/40 focus:bg-white/10 transition-all duration-300 backdrop-blur-sm",whileFocus:{scale:1.01}})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:[u("contactForm.phoneNumber")," *"]}),t.jsx(r.input,{type:"tel",placeholder:"+7 XXX XXX XX XX",value:p.phone,onChange:ee,className:"w-full px-4 py-4 rounded-xl border border-white/20 bg-white/5 text-white placeholder-gray-500 focus:border-white/40 focus:bg-white/10 transition-all duration-300 backdrop-blur-sm",whileFocus:{scale:1.01}})]}),(y||N)&&t.jsxs(r.div,{className:"bg-white/5 border border-white/10 rounded-2xl p-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-300 mb-3",children:u("contactForm.selectedSlot")}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2 text-gray-200",children:[t.jsx(o,{className:"w-4 h-4"}),t.jsx("span",{children:y?.toLocaleDateString()})]}),t.jsxs("div",{className:"flex items-center gap-2 text-gray-200",children:[t.jsx(l,{className:"w-4 h-4"}),t.jsx("span",{children:N})]})]})]})]}),I&&t.jsxs(r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},className:"mt-6 flex items-center gap-2 p-3 bg-red-900/40 text-red-300 rounded-xl border border-red-700/50",children:[t.jsx(m,{className:"w-5 h-5"}),t.jsx("p",{className:"text-sm font-medium",children:I})]}),t.jsx(r.button,{onClick:Q,disabled:F,className:`mt-8 w-full px-6 py-4 rounded-2xl font-semibold text-lg transition-all duration-300 flex items-center justify-center gap-2\n                  ${F?"bg-gray-600/50 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-white to-gray-200 text-black shadow-lg hover:shadow-xl hover:scale-101 btn-dark-theme"}`,whileHover:F?{}:{scale:1.01,y:-2},whileTap:F?{}:{scale:.98},children:F?t.jsxs(t.Fragment,{children:[t.jsx(c,{className:"w-5 h-5 animate-spin"}),u("contactForm.submitting")]}):t.jsxs(t.Fragment,{children:[t.jsx(h,{className:"w-5 h-5"}),u("contactForm.bookConsultation")]})})]})]})]})]})};export{u as default};
